"use strict";

var test = {"items":[{"tags":["sms","twilio"],"owner":{"reputation":49,"user_id":3712321,"user_type":"registered","accept_rate":100,"profile_image":"https://www.gravatar.com/avatar/164e07d0086c414ddd750ee9214e0f4e?s=128&d=identicon&r=PG&f=1","display_name":"user3712321","link":"http://stackoverflow.com/users/3712321/user3712321"},"is_answered":true,"view_count":71,"accepted_answer_id":28922184,"answer_count":1,"score":1,"last_activity_date":1429462196,"creation_date":1425681697,"last_edit_date":1429462196,"question_id":28908934,"link":"http://stackoverflow.com/questions/28908934/what-will-happen-when-sending-raw-bytes-via-sms","title":"What will happen when sending raw bytes via SMS?"},{"tags":["twilio","twiml","twilio-php"],"owner":{"reputation":1,"user_id":4632670,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/64d7b4ace3989e6f79a143aed452f89b?s=128&d=identicon&r=PG&f=1","display_name":"jams panther","link":"http://stackoverflow.com/users/4632670/jams-panther"},"is_answered":false,"view_count":24,"answer_count":1,"score":0,"last_activity_date":1427326405,"creation_date":1425481752,"question_id":28857843,"link":"http://stackoverflow.com/questions/28857843/charging-if-the-recipient-decline-to-answer-twilio","title":"Charging if the recipient decline to answer twilio"},{"tags":["twilio"],"owner":{"reputation":99,"user_id":2967905,"user_type":"registered","accept_rate":79,"profile_image":"http://i.stack.imgur.com/ksqwA.jpg?s=128&g=1","display_name":"Kevin K","link":"http://stackoverflow.com/users/2967905/kevin-k"},"is_answered":true,"view_count":45,"accepted_answer_id":29225655,"answer_count":1,"score":0,"last_activity_date":1427175103,"creation_date":1425643307,"last_edit_date":1426655293,"question_id":28898359,"link":"http://stackoverflow.com/questions/28898359/twilio-client-to-client-call-across-subaccounts","title":"Twilio: client to client call across subaccounts"},{"tags":["javascript","json","node.js","twilio"],"owner":{"reputation":3,"user_id":3293284,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/d71a6f35e615146650ee0e9522595276?s=128&d=identicon&r=PG","display_name":"sandrasvensson","link":"http://stackoverflow.com/users/3293284/sandrasvensson"},"is_answered":true,"view_count":47,"accepted_answer_id":28842149,"answer_count":3,"score":0,"last_activity_date":1426696263,"creation_date":1425417434,"last_edit_date":1426696263,"question_id":28842056,"link":"http://stackoverflow.com/questions/28842056/node-js-app-only-display-the-first-json-object-why","title":"Node JS app only display the first JSON object. Why?"},{"tags":["xml","twilio","voicexml","nexmo","tropo"],"owner":{"reputation":269,"user_id":2305719,"user_type":"registered","profile_image":"http://i.stack.imgur.com/k3ZBA.jpg?s=128&g=1","display_name":"miR","link":"http://stackoverflow.com/users/2305719/mir"},"is_answered":true,"view_count":109,"accepted_answer_id":28887879,"answer_count":1,"score":1,"last_activity_date":1426521848,"creation_date":1425259055,"last_edit_date":1426521848,"question_id":28801353,"link":"http://stackoverflow.com/questions/28801353/what-are-the-differences-between-voicexml-and-twiml-plivoxml","title":"What are the differences between VoiceXML and TwiML / PlivoXML?"},{"tags":["ruby-on-rails-4","twilio","plivo","nexmo"],"owner":{"reputation":466,"user_id":468009,"user_type":"registered","accept_rate":66,"profile_image":"https://www.gravatar.com/avatar/03af361cc843bc56e95cb6c406d06f80?s=128&d=identicon&r=PG","display_name":"A4J","link":"http://stackoverflow.com/users/468009/a4j"},"is_answered":true,"view_count":191,"accepted_answer_id":28999010,"answer_count":2,"score":2,"last_activity_date":1426261077,"creation_date":1425493223,"question_id":28861944,"link":"http://stackoverflow.com/questions/28861944/services-such-as-twilo-plivo-nexmo-to-verify-phone-numbers-in-rails-app","title":"Services (such as Twilo, Plivo, Nexmo) to verify phone numbers in Rails app"},{"tags":["c#","azure","asp.net-mvc-5","twilio"],"owner":{"reputation":5401,"user_id":1077309,"user_type":"registered","accept_rate":82,"profile_image":"http://i.stack.imgur.com/zp2H1.jpg?s=128&g=1","display_name":"Sampath","link":"http://stackoverflow.com/users/1077309/sampath"},"is_answered":false,"view_count":86,"answer_count":1,"score":0,"last_activity_date":1425900742,"creation_date":1425672956,"last_edit_date":1425673509,"question_id":28906898,"link":"http://stackoverflow.com/questions/28906898/500-error-with-twilio-c-rest-api-on-azure-staging","title":"500 error with Twilio C# REST Api on Azure Staging"},{"tags":["ruby-on-rails","activerecord","twilio"],"owner":{"reputation":94,"user_id":2056202,"user_type":"registered","accept_rate":71,"profile_image":"https://www.gravatar.com/avatar/378946c1efd33604a905ef2fd60839a1?s=128&d=identicon&r=PG","display_name":"macoughl","link":"http://stackoverflow.com/users/2056202/macoughl"},"is_answered":false,"view_count":38,"answer_count":0,"score":0,"last_activity_date":1425682953,"creation_date":1425682953,"question_id":28909133,"link":"http://stackoverflow.com/questions/28909133/store-large-data-sets-in-rails-model","title":"Store large data sets in Rails model"},{"tags":["c#-4.0","twilio"],"owner":{"reputation":56,"user_id":1746599,"user_type":"registered","accept_rate":40,"profile_image":"https://www.gravatar.com/avatar/8f711382353dd52dc8e2bda073901b3a?s=128&d=identicon&r=PG","display_name":"07405","link":"http://stackoverflow.com/users/1746599/07405"},"is_answered":false,"view_count":36,"answer_count":0,"score":0,"last_activity_date":1425600800,"creation_date":1425446847,"last_edit_date":1425600800,"question_id":28847242,"link":"http://stackoverflow.com/questions/28847242/messages-not-receiving-to-indian-numbers-using-twilio","title":"Messages not receiving to Indian numbers using Twilio"},{"tags":["node.js","api","twilio"],"owner":{"reputation":15,"user_id":2330474,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/792c916c97b842c70b8841e3d8ab0746?s=128&d=identicon&r=PG","display_name":"ejones","link":"http://stackoverflow.com/users/2330474/ejones"},"is_answered":true,"view_count":23,"accepted_answer_id":28881591,"answer_count":1,"score":1,"last_activity_date":1425569401,"creation_date":1425568513,"question_id":28881267,"link":"http://stackoverflow.com/questions/28881267/twilio-node-js-outgoing-caller-ids-api","title":"Twilio Node.js Outgoing Caller IDs API"},{"tags":["php","mysql","pdo","twilio"],"owner":{"reputation":3012,"user_id":1444609,"user_type":"registered","accept_rate":95,"profile_image":"https://www.gravatar.com/avatar/537454eaec0deea770ad92dce47edb2f?s=128&d=identicon&r=PG","display_name":"Adelphia","link":"http://stackoverflow.com/users/1444609/adelphia"},"is_answered":true,"view_count":26,"accepted_answer_id":28878370,"answer_count":2,"score":0,"last_activity_date":1425560124,"creation_date":1425342182,"question_id":28821894,"link":"http://stackoverflow.com/questions/28821894/sql-storage-in-openvbx-twilio","title":"SQL Storage in OpenVBX (Twilio)"},{"tags":["sms","twilio"],"owner":{"reputation":1,"user_id":4635970,"user_type":"registered","profile_image":"http://graph.facebook.com/10153062775497521/picture?type=large","display_name":"SangHyun Chun","link":"http://stackoverflow.com/users/4635970/sanghyun-chun"},"is_answered":false,"view_count":71,"answer_count":0,"score":0,"last_activity_date":1425548766,"creation_date":1425548766,"question_id":28874648,"link":"http://stackoverflow.com/questions/28874648/id-like-to-change-or-to-hide-ceg-when-use-twilio-sending-message","title":"I&#39;d like to change or to hide [CEG] when use Twilio sending message"},{"tags":["c#","twilio"],"owner":{"reputation":626,"user_id":578178,"user_type":"registered","accept_rate":59,"profile_image":"http://i.stack.imgur.com/zW7of.jpg?s=128&g=1","display_name":"Kamran Shahid","link":"http://stackoverflow.com/users/578178/kamran-shahid"},"is_answered":true,"view_count":35,"accepted_answer_id":28872206,"answer_count":1,"score":0,"last_activity_date":1425540284,"creation_date":1425539095,"last_edit_date":1425540093,"question_id":28871890,"link":"http://stackoverflow.com/questions/28871890/how-to-get-callbackurl-from-twilio-api-against-a-twilio-number","title":"How to get callbackurl from twilio API against a twilio number"},{"tags":["python","google-app-engine","twilio","pytz"],"owner":{"reputation":1,"user_id":4570486,"user_type":"registered","profile_image":"https://lh6.googleusercontent.com/-6ov1mf4LXGc/AAAAAAAAAAI/AAAAAAAAACA/HdZ-OXOcTB4/photo.jpg?sz=128","display_name":"brandon witt","link":"http://stackoverflow.com/users/4570486/brandon-witt"},"is_answered":true,"view_count":85,"closed_date":1426016758,"answer_count":1,"score":-2,"last_activity_date":1425527836,"creation_date":1425525958,"question_id":28869446,"link":"http://stackoverflow.com/questions/28869446/google-app-engine-with-twilio-importerror-no-module-named-pytz","closed_reason":"duplicate","title":"Google App Engine With Twilio: ImportError: No module named pytz"},{"tags":[".net","vb.net","twilio"],"owner":{"reputation":1,"user_id":3550121,"user_type":"registered","profile_image":"http://graph.facebook.com/100001491378206/picture?type=large","display_name":"Luquan Li","link":"http://stackoverflow.com/users/3550121/luquan-li"},"is_answered":false,"view_count":39,"answer_count":1,"score":0,"last_activity_date":1425485736,"creation_date":1425483167,"last_edit_date":1425484629,"question_id":28858391,"link":"http://stackoverflow.com/questions/28858391/twilio-send-sms-return-null","title":"Twilio send sms return null"},{"tags":["php","android","twilio","conferencing"],"owner":{"reputation":1,"user_id":1761003,"user_type":"registered","accept_rate":92,"profile_image":"http://i.stack.imgur.com/PBtrd.jpg?s=128&g=1","display_name":"mave≈à","link":"http://stackoverflow.com/users/1761003/mave%c5%88"},"is_answered":true,"view_count":28,"accepted_answer_id":28857945,"answer_count":1,"score":0,"last_activity_date":1425482000,"creation_date":1425476829,"last_edit_date":1425477540,"question_id":28856092,"link":"http://stackoverflow.com/questions/28856092/error-while-doing-conferencing-in-twilio","title":"Error while doing conferencing in Twilio"},{"tags":["android","maven","twilio"],"owner":{"reputation":360,"user_id":1993913,"user_type":"registered","accept_rate":67,"profile_image":"https://www.gravatar.com/avatar/79b8fe48f2fdb7de706d69c26ec91869?s=128&d=identicon&r=PG","display_name":"Ammar","link":"http://stackoverflow.com/users/1993913/ammar"},"is_answered":false,"view_count":104,"answer_count":1,"score":0,"last_activity_date":1425466281,"creation_date":1425267038,"last_edit_date":1425313213,"question_id":28802272,"link":"http://stackoverflow.com/questions/28802272/duplicate-files-during-packaging-of-an-apk-in-android-studio","title":"Duplicate files during packaging of an APK in Android Studio?"},{"tags":["php","twilio"],"owner":{"reputation":905,"user_id":1010088,"user_type":"registered","accept_rate":90,"profile_image":"https://www.gravatar.com/avatar/36f243e316b33ff7c388da0d17ec3297?s=128&d=identicon&r=PG&f=1","display_name":"Ali Hamze","link":"http://stackoverflow.com/users/1010088/ali-hamze"},"is_answered":true,"view_count":31,"accepted_answer_id":28808935,"answer_count":1,"score":1,"last_activity_date":1425296466,"creation_date":1425249835,"last_edit_date":1425253925,"question_id":28800123,"link":"http://stackoverflow.com/questions/28800123/outgoing-dial-into-conference-from-customers-number","title":"Outgoing Dial Into Conference From Customer&#39;s Number"},{"tags":["twilio"],"owner":{"reputation":8,"user_id":3904762,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/559fb5324351edbe73f9146ad89da1e7?s=128&d=identicon&r=PG&f=1","display_name":"Graham","link":"http://stackoverflow.com/users/3904762/graham"},"is_answered":false,"view_count":27,"answer_count":1,"score":1,"last_activity_date":1425295519,"creation_date":1425234465,"question_id":28797322,"link":"http://stackoverflow.com/questions/28797322/twilio-sms-always-shows-as-delivered","title":"Twilio SMS Always Shows as Delivered"}],"has_more":false,"quota_max":300,"quota_remaining":283};

(function() {
    //this function is creating a set of variables that relate to  what things are being parsed though
    //tag, start/enddate and the period time between them the # is just an anchor

    var tag = document.querySelector("#stack-overflow-tag"),
        startDate = document.querySelector("#start-date"),
        endDate = document.querySelector("#end-date"),
        timePeriod = document.querySelector("#time-period"),

        //returns full year
        year = new Date().getFullYear(),
        //returns month from 0-11 add one for 12 months
        month = new Date().getMonth() + 1,


        //var for number of days in month
        daysinMonth = 31,

    //array objects anything after : is a member

        questions = {
            //this will connect to the variables we have
            tag : "firefox-os",
            startDate : "2014-04-01",
            endDate : "2014-04-31",
            timePeriod : "month",

            //members within members
            //questions with activity
            //unanswered questions
            //top askers
            //related tags
            withActivity : {
                total : 0
            },
            unanswered :  {
                total : 0
            },
            topAskers : {
                items  : []
            },
            faq : {
                items  : []
            },
            relatedTags : {
                items  : []
            }
        };




    // Setting up the form

    //switch statement for month
    switch (month){
        //feb the second month

        case 2:
            daysinMonth = 28;
            break;
        //these are for all the months that end in 30 days
        case 4:
        case 6:
        case 9:
        case 11:

            daysinMonth = 30;
            break;
        default:
            daysinMonth = 31;
    }

    //what is even going on here
    //? then. : else
    //so if month is 9 or below append 0 to month else its month so its 9, then 09
    // you dont do that for 10

    month = (month < 10)? "0" + month : month;

    // for year document.getElementById(id)  start date get value then year then append - and add the day as 01
    startDate.value = year + "-" + month + "-01";
    //end date you are appending the number of days in the given month
    endDate.value = year + "-" + month + "-" + daysinMonth;

    //adding a new query if you submit it it creates an event
    document.querySelector("#selection-form").onsubmit = function (evt) {
        checkReports();
        evt.preventDefault();
    };

//getting the results
    //getting questions with activity calling total activity
    function addResults (type) {
        var questionsWithActivity = questions.withActivity.total,
            unansweredQuestions = questions.unanswered.total,
            //if greater than 10 get %
            percentageUnanswered = (questionsWithActivity > 0)? parseFloat((unansweredQuestions/questionsWithActivity) * 100).toFixed(2) : "100";

        // Popular tags, for filling the <datalist> element
        if (type === "popularTags") {
            var popularTagsList = document.querySelector("#popular-tags"),
                popularTags = questions.popularTags.items,
                //store in popular tags var starting as blank
                popularTagsResults = "";

            //this is just for presetting popular tags
            for (var i=0,l=popularTags.length, tag; i<l; i++) {
                tag = popularTags[i];
                popularTagsResults += "<option value=\"" + tag.name + "\">";
            }

            //return HTMLElementObject.innerHTML loading it into the content form
            popularTagsList.innerHTML = popularTagsResults;
        }


        // With activity load it into the html form at the achor #tag
        if (type === "withActivity") {
            document.querySelector("#questions-with-activity").innerHTML = questionsWithActivity;
        }

        // With activity or unanswered, to compare results
        if (type === "withActivity" || type === "unanswered") {
            //load into
            document.querySelector("#questions-results").innerHTML = percentageUnanswered + "% unanswered";
        }

        // Unanswered
        if (type === "unanswered") {
            document.querySelector("#unanswered-questions").innerHTML = unansweredQuestions;

            //max out to 10 choices
            var unanswered = document.querySelector("#unanswered"),
                allUnanswered = questions.unanswered.items;
            if (allUnanswered) {
                var totalUnanswereds = (allUnanswered.length > 10)? 10 : allUnanswered.length,
                    unansweredResults = "<ul>";

                //plug it into the HTML
                for (var j=0,jl=totalUnanswereds, question; j<jl; j++) {
                    question = allUnanswered[j];
                    unansweredResults += "<li>" +
                    "<a href=\"" + question.link + "\">" +
                    question.title + "</a><br>" +
                    "<small>" + question.tags.toString(", ") + "</small></li>";
                }
                unansweredResults += "</ul>";
                unanswered.innerHTML = unansweredResults;
            }
        }

        // Top answerers
        if (type === "topAnswerers") {
            var topAnswerers = document.querySelector("#top-answerers"),
                allTopAnswerers = questions.topAnswerers.items;
            if (allTopAnswerers) {
                var totalTopAnswerers = (allTopAnswerers.length > 5)? 5 : allTopAnswerers.length,
                    topAnswerersResults = "<ul>";

                for (var k=0,kl=totalTopAnswerers, answerer; k<kl; k++) {
                    answerer = allTopAnswerers[k];
                    topAnswerersResults += "<li>" +
                    "<a href=\"" + answerer.user.link + "\">" +
                    "<img src=\"" + answerer.user.profile_image + "\" alt=\"\">" +
                    answerer.user.display_name + "</a>" + ", Score: " + answerer.score + " (" +
                    answerer.post_count + " question" + ((answerer.post_count > 1)? "s" : "") + ")</li>";
                }
                topAnswerersResults += "</ul>";
                topAnswerers.innerHTML = topAnswerersResults;
            }
        }

        // Top askers
        if (type === "topAskers") {
            var topAskers = document.querySelector("#top-askers"),
                allTopAskers = questions.topAskers.items;
            if (allTopAskers) {
                var totalTopAskers = (allTopAskers.length > 5)? 5 : allTopAskers.length,
                    topAskersResults = "<ul>";

                for (var m=0,ml=totalTopAskers, asker; m<ml; m++) {
                    asker = allTopAskers[m];
                    topAskersResults += "<li>" +
                    "<a href=\"" + asker.user.link + "\">" +
                    "<img src=\"" + asker.user.profile_image + "\" alt=\"\">" +
                    asker.user.display_name + "</a>" + ", " + asker.post_count + " question" + ((asker.post_count > 1)? "s" : "") + "</li>";
                }
                topAskersResults += "</ul>";
                topAskers.innerHTML = topAskersResults;
            }
        }

        // Frequently asked questions
        if (type === "faq") {
            var faq = document.querySelector("#faq"),
                allFaq = questions.faq.items;
            if (allFaq) {
                var totalFaqs = (allFaq.length > 10)? 10 : allFaq.length,
                    faqResults = "<ul>";

                for (var n=0,nl=totalFaqs, faqQuestion; n<nl; n++) {
                    faqQuestion = allFaq[n];
                    faqResults += "<li>" +
                    "<a href=\"" + faqQuestion.link + "\">" +
                    faqQuestion.title + "</a><br>" +
                    "<small>" + faqQuestion.tags.toString(", ") + "</small></li>";
                }
                faqResults += "</ul>";
                faq.innerHTML = faqResults;
            }
        }

        // Related tags
        if (type === "relatedTags") {
            var relatedTags = document.querySelector("#related-tags"),
                allRelatedTags = questions.relatedTags.items;
            if (allRelatedTags) {
                var totalRelatedTags = (allRelatedTags.length > 10)? 10 : allRelatedTags.length,
                    relatedTagsResults = "<ul>";

                for (var o=0,ol=totalRelatedTags, relatedTag; o<ol; o++) {
                    relatedTag = allRelatedTags[o];
                    relatedTagsResults += "<li>" +
                    "<a href=\"http://stackoverflow.com/questions/tagged/" + relatedTag.name + "\">" +
                    relatedTag.name + "</a></li>";
                }
                relatedTagsResults += "</ul>";
                relatedTags.innerHTML = relatedTagsResults;
            }
        }
    }

    //showing call errors shown on HTML anchor
    function showErrors (name, msg) {
        var error = document.querySelector("#error");
        error.innerHTML = name + "<br>" + msg;
    }


    function getItems(type, url) {

        //The XMLHttpRequest object is used to exchange data with a server behind the scenes
        var xhr = new XMLHttpRequest();

        //Stores a function (or the name of a function) to be called automatically each time the readyState property changes
        xhr.onreadystatechange = function () {

            //Get the loading status of the current document
            if (xhr.readyState === 4) {
                console.log("Type: " + type);
                console.log(xhr.response);
                var response = xhr.response,
                    quotaRemaining = response.quota_remaining;

                if (response.error_message) {
                    showErrors(response.error_name, response.error_message);
                }
                else {
                    questions[type] = response;
                    addResults(type);
                }

                // Remining requests today from your IP
                if (quotaRemaining) {
                    document.querySelector("#remaining-requests").innerHTML = quotaRemaining;
                }
            }
        };

        //same as xmlhttp.open("GET","ajax_info.txt",true);
        xhr.open("GET", url, true);
        xhr.responseType = "json";
        xhr.send(null);
    }

    //getting as a json object
    //plugging in values
    function getQuestionsWithActivity () {
        // All questions for a certain time period - http://api.stackexchange.com/docs/search
        getItems("withActivity", "http://api.stackexchange.com/2.2/search?fromdate=" + questions.startDate + "&todate=" + questions.	endDate + "&order=desc&sort=activity&tagged=" + questions.tag + "&site=stackoverflow&filter=!9WA((MBIa");
    }

    function getUnansweredQuestions () {
        // All questions without an answer for a certain time period - http://api.stackexchange.com/docs/unanswered-questions
        // "At this time a question must have at least one upvoted answer to be considered answered"
        getItems("unanswered", "http://api.stackexchange.com/2.2/questions/unanswered?fromdate=" + questions.startDate + "&todate=" + questions.endDate + "&order=desc&sort=activity&tagged=" + questions.tag + "&site=stackoverflow&filter=!9WA((MBIa");
    }

    function topAnswerers () {
        getItems("topAnswerers", "http://api.stackexchange.com/2.2/tags/" + questions.tag + "/top-answerers/" + questions.timePeriod + "?site=stackoverflow");
    }

    function topAskers () {
        getItems("topAskers", "http://api.stackexchange.com/2.2/tags/" + questions.tag + "/top-askers/" + questions.timePeriod + "?site=stackoverflow");
    }

    function faq () {
        getItems("faq", "http://api.stackexchange.com/2.2/tags/" + questions.tag + "/faq?site=stackoverflow");
    }

    function relatedTags () {
        getItems("relatedTags", "http://api.stackexchange.com/2.2/tags/" + questions.tag + "/related?site=stackoverflow");
    }

    //checking values
    function checkReports () {
        questions.tag = tag.value;
        questions.startDate = startDate.value;
        questions.endDate = endDate.value;
        questions.timePeriod = timePeriod.value;

        // Get reports
        getQuestionsWithActivity();
        getUnansweredQuestions();
        topAnswerers();
        topAskers();
        faq();
        relatedTags();
    }

    function getPopularTags () {
        getItems("popularTags", "http://api.stackexchange.com/2.2/tags?pagesize=100&order=desc&sort=popular&site=stackoverflow");
    }

    // Run automatically at page load to pre-populate the <datalist> element
    getPopularTags();
})();







